# Отчет Лебедев Андрей Андреевич БПИ234

## Вариант 21

**Задача о нелюдимых садовниках**. Имеется пустой участок
земли (двумерный массив размером M ×N) и план сада, разбитого
на отдельные квадраты. От 10 до 30 процентов (задается случайно) площади сада заняты прудами или камнями. То есть недоступны для ухаживания. Эти квадраты располагаются на плане произвольным (случайным) образом. Ухаживание за садом выполняют два садовника, которые не хотят встречаться друг другом (то
есть, одновременно появляться в одном и том же квадрате). Первый садовник начинает работу с верхнего левого угла сада и перемещается слева направо, сделав ряд, он спускается вниз и идет в
обратном направлении, пропуская обработанные участки. Второй
садовник начинает работу с нижнего правого угла сада и перемещается снизу вверх, сделав ряд, он перемещается влево и также
идет в обратную сторону. Если садовник видит, что участок сада
уже обработан другим садовником или является необрабатывае18
мым, он идет дальше. Если по пути какой-то участок занят другим садовником, то садовник ожидает когда участок освободится,
чтобы пройти дальше на доступный ему необработанный участок.
Садовники должны работать одновременно со скоростями, определяемыми как параметры задачи. Прохождение через любой
квадрат занимает некоторое время, которое задается константой,
меньшей чем времена обработки и принимается за единицу времени

## Описание решения

Два садовника (процесса) обрабатывают общий сад, представленный матрицей M×N. Каждая клетка сада может находиться в одном из состояний:

-   `1` - необработанная
-   `2` - обработана садовником 1
-   `3` - обработана садовником 2
-   `0` - препятствие (не обрабатывается)
    Каждый садовник имеет:

Собственный алгоритм движения по саду.

Семафоры для каждой клетки, чтобы избежать одновременной обработки.

### Алгоритм работы садовников

#### Садовник 1

1. Начинает с клетки (0, 0)
2. Движется построчно змейкой:
    - Четные строки: слева направо
    - Нечетные строки: справа налево
3. Завершает работу после обработки (M-1, N-1)

#### Садовник 2

1. Начинает с клетки (M-1, N-1)
2. Движется по столбцам змейкой:
    - Четные столбцы: снизу вверх
    - Нечетные столбцы: сверху вниз
3. Завершает работу после обработки (0, 0)

### Обработка клетки

1. Захватить семафор клетки (`sem_wait`)
2. Если клетка необработана (1):
    - Пометить как обработанную (2 или 3)
    - Имитировать работу (`usleep`)
3. Освободить семафор (`sem_post`)

## Пример вывода

```
[Садовник 1] Обрабатывает клетку (0, 0)
[Садовник 2] Обрабатывает клетку (9, 9)
[Садовник 1] Обрабатывает клетку (0, 1)
[Садовник 2] Обрабатывает клетку (8, 9)
...

Итоговое состояние сада:
1 1 1 1 1 1 X 1 2 2
1 1 1 X 1 X 1 1 2 2
1 X 1 1 X 1 2 2 2 2
1 X 1 1 1 1 2 X X 2
1 X 1 1 X X 2 2 X 2
X 1 1 2 2 2 2 2 X 2
1 X 2 2 X 2 X X 2 2
1 2 2 2 2 2 2 X X 2
1 2 2 2 X 2 2 2 X 2
2 2 2 2 2 2 2 X X 2
```

### Обозначения:

-   `1` - обработана садовником 1 (2)
-   `2` - обработана садовником 2 (3)
-   `X` - препятствие (0)

## 4-5

### Описание решения

В решении используются **именованные POSIX-семафоры** — по одному на каждую клетку сада для синхронизации между двумя процессами-садовниками.  
Обмен данными реализован через **разделяемую память**, в которой хранится матрица состояния клеток и указатели на семафоры.  
Также добавлена обработка `SIGINT` для корректного завершения программы и освобождения всех ресурсов.

### Запуск

```
gcc main.c -o out
./out -t1 1 -t2 2
```

## 6-7

### Описание решения

В решении используются **неименованные POSIX-семафоры**, встроенные в структуру разделяемой памяти — по одному на каждую клетку сада. Это обеспечивает синхронизацию доступа между двумя процессами-садовниками.

### Запуск

Аналогично 4-5

## 8

### Описание решения

В этом решении используется **разделяемая память System V (`shmget`, `shmat`)**, в которой хранится матрица сада. Для синхронизации доступа к каждой клетке применяется **набор семафоров System V (`semget`, `semop`)** — по одному на каждую клетку.  
Каждый садовник запускается как отдельный независимый процесс с аргументом (`1` или `2`).  
Программа поддерживает **корректное завершение через `SIGINT`**, с освобождением ресурсов (`shmctl`, `semctl`) и выводом итогового состояния.  
Также добавлен файл run.sh для удобного запуска программы

#### run.sh

```
#!/bin/bash

# Инициализация ресурсов в фоне
./out init &
sleep 1  # Ждём, пока init создаст ресурсы

# Запускаем садовников параллельно
./out 1 -t1 1 &
./out 2 -t2 2 &

# Ждём завершения обоих
wait
```

### Запуск

```bash
gcc main.c -o out
chmod +x run.sh
./run.sh
```

## 9

### Описание решения

В этом решении используется **очередь сообщений POSIX (`mq_open`, `mq_send`, `mq_receive`)** для хранения и обмена состоянием сада между независимыми процессами.  
Для синхронизации доступа к очереди применяется **именованный POSIX-семафор (`sem_open`)**.  
Каждый садовник запускается как отдельный процесс с аргументом (`1` или `2`) и работает независимо.  
Добавлена обработка `SIGINT` для корректного завершения и удаления всех ресурсов (`mq_unlink`, `sem_unlink`).

### Запуск

Аналогично 8

## 10

### Описание решения

В этом решении используется **разделяемая память System V** (`shmget`, `shmat`) для хранения состояния сада, и **семафоры System V** (`semget`, `semop`) для синхронизации работы садовников. Каждый садовник представляет собой отдельный процесс, который обрабатывает клетки сада.

-   Для синхронизации доступа к каждой клетке сада используется семафор.
-   Программа включает обработку сигнала `SIGINT`, который позволяет корректно завершить программу и освободить ресурсы (разделяемую память и семафоры).
-   В `main` предусмотрена возможность запуска программы для инициализации ресурсов или для работы садовников. Садовники могут быть запущены с параметром времени, чтобы регулировать скорость их работы.

Программа корректно завершает работу, очищая все ресурсы, такие как семафоры и разделяемую память, при получении сигнала `SIGINT`.

### Запуск

Аналогично 8
